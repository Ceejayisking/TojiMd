const _0x38fabb=_0x1c90;(function(_0x5376a9,_0xa42b70){const _0x30933f=_0x1c90,_0x1a840c=_0x5376a9();while(!![]){try{const _0x15c60d=-parseInt(_0x30933f(0x1ce))/0x1*(parseInt(_0x30933f(0x1af))/0x2)+-parseInt(_0x30933f(0x1c2))/0x3*(parseInt(_0x30933f(0x1b9))/0x4)+-parseInt(_0x30933f(0x193))/0x5*(parseInt(_0x30933f(0x1de))/0x6)+-parseInt(_0x30933f(0x1d0))/0x7+parseInt(_0x30933f(0x1b1))/0x8+parseInt(_0x30933f(0x1bc))/0x9+parseInt(_0x30933f(0x1b2))/0xa*(parseInt(_0x30933f(0x1bb))/0xb);if(_0x15c60d===_0xa42b70)break;else _0x1a840c['push'](_0x1a840c['shift']());}catch(_0xdb9ec8){_0x1a840c['push'](_0x1a840c['shift']());}}}(_0x383d,0xf0026));import{dirname}from'path';import{fileURLToPath}from'url';import*as _0x160915 from'fs';import*as _0x5023e9 from'path';import*as _0x1eaa89 from'crypto';import{ffmpeg}from'./converter.js';import _0x2a33dc from'fluent-ffmpeg';import{spawn}from'child_process';function _0x383d(){const _0xc048b=['198957EhoBFK','14242194NWFVqT','status','save','bin','length','unlink','6epkZkI','https://nurutomo.herokuapp.com/api/canvas?','webp','close','writeFile','-vf','application/octet-stream','readFile','scale=\x27min(320,iw)\x27:min\x27(320,ih)\x27:force_original_aspect_ratio=decrease,fps=15,\x20pad=320:320:-1:-1:color=white@0.0,\x20split\x20[a][b];\x20[a]\x20palettegen=reserve_transparent=on:transparency_color=ffffff\x20[p];\x20[b][p]\x20paletteuse','from','input','png','1WqNcLL','stdout','8646001GMTYzM','text/plain','join','WEBP','https://api.xteam.xyz/sticker/wm?','test','entries','exports','buffer','scale=512:512:flags=lanczos:force_original_aspect_ratio=decrease,format=rgba,pad=512:512:(ow-iw)/2:(oh-ih)/2:color=#00000000,setsar=1','data','mime','png:-','toString','444QXfAkb','ext','43105VhfUJi','pipe','magick','let\x20im\x20=\x20await\x20loadImg(\x27data:','promises','../tmp','-vcodec','\x27)))\x0ac.width\x20=\x20c.height\x20=\x20512\x0alet\x20max\x20=\x20Math.max(im.width,\x20im.height)\x0alet\x20w\x20=\x20512\x20*\x20im.width\x20/\x20max\x0alet\x20h\x20=\x20512\x20*\x20im.height\x20/\x20max\x0actx.drawImage(im,\x20256\x20-\x20w\x20/\x202,\x20256\x20-\x20h\x20/\x202,\x20w,\x20h)\x0a','includes','filter','push','addOutputOptions','../tmp/','inputFormat','end','.webp','wa-sticker-formatter','ffmpeg','writeUIntLE','POST','exif','chat','text','concat','randomBytes','exit','Image','jpeg','56618KiLLGH','stdin','1316536hIePWv','1170qOOhLC','error','convert','default','support','toFormat',';base64,\x27+(await\x20window.loadToDataURI(\x27','1957456KCLyHm','image/jpeg'];_0x383d=function(){return _0xc048b;};return _0x383d();}import _0x307657 from'./uploadFile.js';import _0x56b369 from'./uploadImage.js';import{fileTypeFromBuffer}from'file-type';import _0x12f54d from'node-webpmux';import _0x1463f7 from'node-fetch';const __dirname=dirname(fileURLToPath(import.meta['url'])),tmp=_0x5023e9[_0x38fabb(0x1d2)](__dirname,_0x38fabb(0x198));function sticker2(_0x4ce35f,_0x1eb753){return new Promise(async(_0x15f778,_0x565fd3)=>{const _0x28f7e4=_0x1c90;try{if(_0x1eb753){let _0x5a617c=await _0x1463f7(_0x1eb753);if(_0x5a617c[_0x28f7e4(0x1bd)]!==0xc8)throw await _0x5a617c[_0x28f7e4(0x1a9)]();_0x4ce35f=await _0x5a617c[_0x28f7e4(0x1d8)]();}let _0x5d8aee=_0x5023e9[_0x28f7e4(0x1d2)](tmp,+new Date()+'.jpeg');await _0x160915['promises'][_0x28f7e4(0x1c6)](_0x5d8aee,_0x4ce35f);let _0x348443=spawn(_0x28f7e4(0x1a4),['-y','-i',_0x5d8aee,_0x28f7e4(0x1c7),_0x28f7e4(0x1d9),'-f',_0x28f7e4(0x1cd),'-']);_0x348443['on'](_0x28f7e4(0x1b3),_0x565fd3),_0x348443['on'](_0x28f7e4(0x1c5),async()=>{const _0x5bc023=_0x28f7e4;await _0x160915[_0x5bc023(0x197)][_0x5bc023(0x1c1)](_0x5d8aee);});let _0x2fb6c1=[];const [_0x5a0f03,..._0xbfc281]=[...module[_0x28f7e4(0x1d7)][_0x28f7e4(0x1b6)]['gm']?['gm']:module[_0x28f7e4(0x1d7)]['magick']?[_0x28f7e4(0x195)]:[],_0x28f7e4(0x1b4),_0x28f7e4(0x1dc),'webp:-'];let _0x5a2ce4=spawn(_0x5a0f03,_0xbfc281);_0x5a2ce4['on']('error',_0x478ce8=>conn['reply'](m[_0x28f7e4(0x1a8)],util['format'](_0x478ce8),m)),_0x5a2ce4[_0x28f7e4(0x1cf)]['on'](_0x28f7e4(0x1da),_0x184ed7=>_0x2fb6c1[_0x28f7e4(0x19d)](_0x184ed7)),_0x348443[_0x28f7e4(0x1cf)][_0x28f7e4(0x194)](_0x5a2ce4[_0x28f7e4(0x1b0)]),_0x5a2ce4['on'](_0x28f7e4(0x1ac),()=>{const _0x2d5388=_0x28f7e4;_0x15f778(Buffer[_0x2d5388(0x1aa)](_0x2fb6c1));});}catch(_0x4a2d64){_0x565fd3(_0x4a2d64);}});}async function canvas(_0x6018df,_0x3a6c12=_0x38fabb(0x1cd),_0x5380e9=0.92){const _0x54e76b=_0x38fabb;let _0x19ee7c=await _0x1463f7(_0x54e76b(0x1c3)+queryURL({'type':_0x3a6c12,'quality':_0x5380e9}),{'method':_0x54e76b(0x1a6),'headers':{'Content-Type':_0x54e76b(0x1d1),'Content-Length':_0x6018df[_0x54e76b(0x1c0)]},'body':_0x6018df}),_0x5ff0f5=await _0x19ee7c[_0x54e76b(0x1d8)]();return _0x5ff0f5;}function _0x1c90(_0x2fc909,_0x17a6d3){const _0x383d0e=_0x383d();return _0x1c90=function(_0x1c90d7,_0x2fb2fa){_0x1c90d7=_0x1c90d7-0x193;let _0x4bf893=_0x383d0e[_0x1c90d7];return _0x4bf893;},_0x1c90(_0x2fc909,_0x17a6d3);}function queryURL(_0x452cd4){return new URLSearchParams(Object['entries'](_0x452cd4));}async function sticker1(_0x42fc78,_0x2e3259){const _0x11f2b1=_0x38fabb;_0x2e3259=_0x2e3259?_0x2e3259:await _0x56b369(_0x42fc78);let {mime:_0x5d33e3}=_0x2e3259?{'mime':_0x11f2b1(0x1ba)}:await fileTypeFromBuffer(_0x42fc78),_0x50510a=_0x11f2b1(0x196)+_0x5d33e3+_0x11f2b1(0x1b8)+_0x2e3259+_0x11f2b1(0x19a);return await canvas(_0x50510a,_0x11f2b1(0x1c4));}async function sticker3(_0x1cefe4,_0x44a76e,_0x4aee96,_0x420529){const _0x360226=_0x38fabb;_0x44a76e=_0x44a76e?_0x44a76e:await _0x307657(_0x1cefe4);let _0x584f4e=await _0x1463f7(_0x360226(0x1d4)+new URLSearchParams(Object[_0x360226(0x1d6)]({'url':_0x44a76e,'packname':_0x4aee96,'author':_0x420529})));return await _0x584f4e['buffer']();}async function sticker4(_0x4df584,_0x4f9fb4){const _0x5848d8=_0x38fabb;if(_0x4f9fb4){let _0x3aec0e=await _0x1463f7(_0x4f9fb4);if(_0x3aec0e[_0x5848d8(0x1bd)]!==0xc8)throw await _0x3aec0e['text']();_0x4df584=await _0x3aec0e[_0x5848d8(0x1d8)]();}return await ffmpeg(_0x4df584,[_0x5848d8(0x1c7),'scale=512:512:flags=lanczos:force_original_aspect_ratio=decrease,format=rgba,pad=512:512:(ow-iw)/2:(oh-ih)/2:color=#00000000,setsar=1'],_0x5848d8(0x1ae),'webp');}async function sticker5(_0x1c26e3,_0x40fefc,_0x2b012b,_0x52c347,_0x110199=[''],_0x3d46d7={}){const _0x516eac=_0x38fabb,{Sticker:_0x296472}=await import(_0x516eac(0x1a3)),_0x5c4ecc={'type':_0x516eac(0x1b5),'pack':_0x2b012b,'author':_0x52c347,'categories':_0x110199,..._0x3d46d7};return new _0x296472(_0x1c26e3?_0x1c26e3:_0x40fefc,_0x5c4ecc)['toBuffer']();}function sticker6(_0x73700c,_0xc6f13e){return new Promise(async(_0x4c3941,_0x54b722)=>{const _0x3d8bd4=_0x1c90;if(_0xc6f13e){let _0x48b893=await _0x1463f7(_0xc6f13e);if(_0x48b893[_0x3d8bd4(0x1bd)]!==0xc8)throw await _0x48b893[_0x3d8bd4(0x1a9)]();_0x73700c=await _0x48b893[_0x3d8bd4(0x1d8)]();}const _0x55d4a4=await fileTypeFromBuffer(_0x73700c)||{'mime':_0x3d8bd4(0x1c8),'ext':_0x3d8bd4(0x1bf)};if(_0x55d4a4[_0x3d8bd4(0x1df)]==_0x3d8bd4(0x1bf))_0x54b722(_0x73700c);const _0x47c67b=_0x5023e9[_0x3d8bd4(0x1d2)](__dirname,_0x3d8bd4(0x19f)+ +new Date()+'.'+_0x55d4a4['ext']),_0x5de711=_0x5023e9[_0x3d8bd4(0x1d2)](_0x47c67b+_0x3d8bd4(0x1a2));await _0x160915[_0x3d8bd4(0x197)][_0x3d8bd4(0x1c6)](_0x47c67b,_0x73700c);let _0x13fe5c=/video/i[_0x3d8bd4(0x1d5)](_0x55d4a4[_0x3d8bd4(0x1db)])?_0x2a33dc(_0x47c67b)[_0x3d8bd4(0x1a0)](_0x55d4a4[_0x3d8bd4(0x1df)]):_0x2a33dc(_0x47c67b)[_0x3d8bd4(0x1cc)](_0x47c67b);_0x13fe5c['on']('error',function(_0x42b824){const _0x143a10=_0x3d8bd4;console[_0x143a10(0x1b3)](_0x42b824),_0x160915[_0x143a10(0x197)][_0x143a10(0x1c1)](_0x47c67b),_0x54b722(_0x73700c);})['on'](_0x3d8bd4(0x1a1),async function(){const _0x5e35c6=_0x3d8bd4;_0x160915[_0x5e35c6(0x197)]['unlink'](_0x47c67b),_0x4c3941(await _0x160915[_0x5e35c6(0x197)][_0x5e35c6(0x1c9)](_0x5de711));})[_0x3d8bd4(0x19e)]([_0x3d8bd4(0x199),'libwebp',_0x3d8bd4(0x1c7),_0x3d8bd4(0x1ca)])[_0x3d8bd4(0x1b7)](_0x3d8bd4(0x1c4))[_0x3d8bd4(0x1be)](_0x5de711);});}async function addExif(_0x5f459f,_0x46916e,_0x3f9d9c,_0x29648b=[''],_0x52735a={}){const _0x9ec763=_0x38fabb,_0x27fcf1=new _0x12f54d[(_0x9ec763(0x1ad))](),_0x339eec=_0x1eaa89[_0x9ec763(0x1ab)](0x20)[_0x9ec763(0x1dd)]('hex'),_0x3ce465={'sticker-pack-id':_0x339eec,'sticker-pack-name':_0x46916e,'sticker-pack-publisher':_0x3f9d9c,'emojis':_0x29648b,..._0x52735a};let _0x569306=Buffer[_0x9ec763(0x1cb)]([0x49,0x49,0x2a,0x0,0x8,0x0,0x0,0x0,0x1,0x0,0x41,0x57,0x7,0x0,0x0,0x0,0x0,0x0,0x16,0x0,0x0,0x0]),_0x10c9e9=Buffer[_0x9ec763(0x1cb)](JSON['stringify'](_0x3ce465),'utf8'),_0x552e63=Buffer['concat']([_0x569306,_0x10c9e9]);return _0x552e63[_0x9ec763(0x1a5)](_0x10c9e9[_0x9ec763(0x1c0)],0xe,0x4),await _0x27fcf1['load'](_0x5f459f),_0x27fcf1[_0x9ec763(0x1a7)]=_0x552e63,await _0x27fcf1['save'](null);}async function sticker(_0x1cdeeb,_0x39580e,..._0x54603b){const _0xc2c016=_0x38fabb;let _0x18e9ba,_0x5c047e;for(let _0x5a9610 of[sticker3,global['support'][_0xc2c016(0x1a4)]&&sticker6,sticker5,global['support'][_0xc2c016(0x1a4)]&&global['support']['ffmpegWebp']&&sticker4,global[_0xc2c016(0x1b6)][_0xc2c016(0x1a4)]&&(global[_0xc2c016(0x1b6)][_0xc2c016(0x1b4)]||global[_0xc2c016(0x1b6)][_0xc2c016(0x195)]||global[_0xc2c016(0x1b6)]['gm'])&&sticker2,sticker1][_0xc2c016(0x19c)](_0x4afcf4=>_0x4afcf4)){try{_0x5c047e=await _0x5a9610(_0x1cdeeb,_0x39580e,..._0x54603b);if(_0x5c047e[_0xc2c016(0x19b)](_0xc2c016(0x1d3)))try{return await addExif(_0x5c047e,..._0x54603b);}catch(_0x190934){return console[_0xc2c016(0x1b3)](_0x190934),_0x5c047e;}if(_0x5c047e[_0xc2c016(0x19b)]('html'))continue;throw _0x5c047e[_0xc2c016(0x1dd)]();}catch(_0x45dc31){_0x18e9ba=_0x45dc31;continue;}}return console[_0xc2c016(0x1b3)](_0x18e9ba),_0x18e9ba;}const support={'ffmpeg':!![],'ffprobe':!![],'ffmpegWebp':!![],'convert':!![],'magick':![],'gm':![],'find':![]};export{sticker,sticker1,sticker2,sticker3,sticker4,sticker5,sticker6,addExif,support};